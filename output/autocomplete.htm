<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="utf-8">
    <title>Traductor de cartas de HearthStone v0.8.0</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/awesomplete/1.0.0/awesomplete.min.css">
    <style type="text/css">
      body {
        background: black;
      }
      .main-wrapper {
        background: rgb(233,233,233);
        max-width: 800px;
        min-width: 500px;
        margin-left: auto;
        margin-right: auto;
        padding: 20px;
      }
      h1 {
        text-align: center;
        font-size: 1.4em;
        color: rgb(60, 60, 60);
      }
      table {
        width: 100%;
      }
      table, th, td {
        border: 1px solid black;
        border-collapse: collapse;
        padding: 10px;
      }
      td:first-child {
        white-space: nowrap;
      }
      td:last-child {
        width: 99%;
      }
      footer {
        text-align: center;
      }
      footer a {
        font-size: 0.6em;
        color: rgb(150, 150, 150);
      }
    </style>
  </head>
  <body>
    <div class="main-wrapper">
      <h1>Traductor de cartas de HearthStone v0.8.0</h1>
      <table>
        <tr>
          <th></th>
          <th>Origen</th>
          <th>Destino</th>
        </tr>
        <tr>
          <td>Lenguaje</td>
          <td>
            <select id="sourceLanguage">
              <option value="enUS">enUS</option>
              <option value="esMX" selected>esMX</option>
              <option value="esES">esES</option>
              <option value="frFR">frFR</option>
              <option value="zhTW">zhTW</option>
              <option value="zhCN">zhCN</option>
              <option value="ruRU">ruRU</option>
              <option value="ptBR">ptBR</option>
              <option value="plPL">plPL</option>
              <option value="koKR">koKR</option>
              <option value="itIT">itIT</option>
              <option value="deDE">deDE</option>
              <option value="enGB">enGB</option>
              <option value="jaJP">jaJP</option>
            </select>
          </td>
          <td>
            <select id="targetLanguage">
              <option value="enUS" selected>enUS</option>
              <option value="esMX">esMX</option>
              <option value="esES">esES</option>
              <option value="frFR">frFR</option>
              <option value="zhTW">zhTW</option>
              <option value="zhCN">zhCN</option>
              <option value="ruRU">ruRU</option>
              <option value="ptBR">ptBR</option>
              <option value="plPL">plPL</option>
              <option value="koKR">koKR</option>
              <option value="itIT">itIT</option>
              <option value="deDE">deDE</option>
              <option value="enGB">enGB</option>
              <option value="jaJP">jaJP</option>
            </select>
          </td>
        </tr>
        <tr>
          <td>Nombre de la carta</td>
          <td>
            <input class="awesomplete" id="cardNames" placeholder="Nombre de la carta a traducir" size="25">
          </td>
          <td>
            <div id="result"></div>
          </td>
        </tr>
      </table>
      <footer><a href="https://github.com/protron">Developed by Mariano Desanze</a></footer>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/awesomplete/1.0.0/awesomplete.min.js"></script>
    <script>
      var nameTranslations;
      var awesomplete;
      function updateResult() {
        var selectedCard = document.getElementById("cardNames").value;
        var selectedTargetLang = document.getElementById("targetLanguage").value;
        var translations = nameTranslations[selectedCard];
        var translatedName = translations[selectedTargetLang];
        var resultEl = document.getElementById("result");
        resultEl.innerHTML = translatedName;
      }
      function initAwesomplete() {
        var input = document.getElementById("cardNames");
        awesomplete = new Awesomplete(input);
        awesomplete.minChars = 1;
        awesomplete.autoFirst = true;
        input.addEventListener("awesomplete-selectcomplete", updateResult, true);
      }
      function updateAwesomplete(nameTranslations) {
        var cardOptions = getObjectKeys(nameTranslations);
        awesomplete.list = cardOptions;
      }
      function getObjectKeys(obj) {
        var keys = [];
        for (var key in obj)
          if (obj.hasOwnProperty(key))
            keys.push(key);
        return keys;
      }
      function getUrlTranslations(sourceLanguage) {
        return 'translations-' + sourceLanguage + '.json?v=0.8.0' // version in url param just for enforce cache expiration
      }
      function clearTexts() {
        awesomplete.input.value = null;
        document.getElementById("result").textContent = null;
      }
      async function loadTranslations() {
        clearTexts();
        let sourceLanguage = document.getElementById("sourceLanguage").value;
        console.log("Loading translations for " + sourceLanguage);
        let urlTranslations = getUrlTranslations(sourceLanguage);
        let jsFileContent = await fetch(urlTranslations);
        let data = await jsFileContent.json();
        nameTranslations = data;
        updateAwesomplete(nameTranslations);
        console.log("Loaded translations for " + sourceLanguage);
      }
      async function init() {
        initAwesomplete();
        document.getElementById("sourceLanguage").addEventListener("change", loadTranslations);
        await loadTranslations();
        document.getElementById("targetLanguage").addEventListener("change", updateResult);
      }
      init();
    </script>
  </body>
</html>